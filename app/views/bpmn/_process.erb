<process id="<%= id %>" name="<%= name %>" isExecutable="true">

<% link_start = "project-#{project.id}-start" %>
<startEvent id="<%= link_start %>"/>

<% start_sentry = "project-#{project.id}-start-sentry" %>

  <%
	project_id = project.id
	if project.description.blank?
     description = "Description withheld"
     else
     description = project.description
     end
     protocol = "No protocol"
     %>
  <%= render :partial => "bpmn/start_sentry",
      	     :locals => {:id => start_sentry,
	     	     	 :name => "#{project.title} Start Sentry",
			 :pisa_assignee => "alan.r.williams@manchester.ac.uk",
			 :pisa_type => "Project",
			 :pisa_name => "#{project.title}",
			 :pisa_description => "#{description}",
			 :pisa_protocol => "#{protocol}",
			 :pisa_url => "#{ Seek::Config.site_base_host}#{polymorphic_path(project)}",
			 :project_id => project_id} -%>

  <sequenceFlow sourceRef="<%= link_start %>" targetRef="<%= start_sentry %>" id="<%= link_start %>-to-<%= start_sentry %>"/>

<% link_start = start_sentry %>

<% project.investigations.each do |i| %>
  <%= render :partial => "bpmn/investigation", :locals => { :investigation => i , :project_id => project_id } -%>

  <% link_end = "investigation-#{i.id}" %>
  <sequenceFlow sourceRef="<%= link_start %>" targetRef="<%= link_end %>" id="<%= link_start %>-to-<%= link_end %>"/>

  <% link_start = "investigation-#{i.id}" %>
<% end %>

<% finish_sentry = "project-#{project.id}-finish-sentry" %>

  <%= render :partial => "bpmn/finish_sentry",
      	     :locals => {:id => finish_sentry,
	     	     	 :name => "#{project.title} Finish Sentry",
			 :pisa_assignee => "alan.r.williams@manchester.ac.uk",
			 :pisa_type => "Project",
			 :pisa_name => "#{project.title}",
			 :pisa_description => "#{description}",
			 :pisa_protocol => "#{protocol}",
			 :pisa_url => "#{ Seek::Config.site_base_host}#{polymorphic_path(project)}",
			 :project_id => project_id} -%>

  <sequenceFlow sourceRef="<%= link_start %>" targetRef="<%= finish_sentry %>" id="<%= link_start %>-to-<%= finish_sentry %>"/>

  <% link_start = finish_sentry %>
<% link_end="project-#{project.id}-end" %>
<endEvent id="<%=link_end %>"/>

<sequenceFlow sourceRef="<%= link_start %>" targetRef="<%= link_end %>" id="<%= link_start %>-to-<%= link_end %>"/>

</process>
