<% if Seek::Config.email_enabled && !resource.managers.empty? -%>
    <%
       resource_type = text_for_resource(resource)
    %>

      <div id="request_resource_form" style="display:none;margin-left:10%;">
        <% form_remote_tag :url => polymorphic_url(resource, :action => :request_resource),
                           :before => "requestingResourceStatus();" do -%>

            <p>
              An email will be sent to <%= join_with_and(resource.managers.collect { |m| m.name }) -%> to let them know
              of your interest.<br/>
              Please provide some extra information you feel may be useful to your request.
            </p>

            <p>
              <%= text_area_tag :details, '', :cols => 80, :rows => 10 -%>
              <br/>
              <%= submit_tag 'Send', :confirm => "An email will be delivered with your request to #{join_with_and(resource.managers.collect { |m| m.name })}. Are you sure?" -%>
            </p>
        <% end -%>
      </div>

    <center>
      <div id="requesting_resource_status" style="display:none;">About to request access to
        the <%= resource_type -%> <%= resource.title %>
        from <%= h(resource.managers.collect { |p| p.name }.join(", ")) %>
        ...
      </div>
    </center>
    <br/>
<% end %>

<script type="text/javascript">
    function requestResourceForm() {
        if ($("request_resource_form") != null){
            Effect.Appear('request_resource_form');
            $('request_resource_button').hide();
        }else{
            alert("Unable to send emails - email is disabled");
        }
    }

    function requestingResourceStatus() {
        Effect.Appear('requesting_resource_status');
        $('request_resource_form').hide();
    }
</script>