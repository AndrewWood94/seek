
<% if asset.is_downloadable? -%>
    <% display_asset = asset.find_version(version) %>
    <%# param code is used for temporary link -%>
    <% if display_asset.contains_downloadable_items? && can_download_asset?(asset, params[:code]) -%>
        <%
           path = polymorphic_path(asset,:version=>version,:action=>:download,:code=>params[:code])
        %>
        <li>
          <%= image_tag_for_key('download', path, "Download #{human_name}", nil, "Download #{human_name}") -%>
        </li>
        <% if asset.is_a?(DataFile) && display_asset.contains_extractable_spreadsheet? %>
            <li>
              <%= image_tag_for_key('spreadsheet', polymorphic_path(asset, :version => version, :action => :explore, :code=>params[:code]), "Explore #{human_name}", nil, "Explore #{human_name}") -%>
            </li>
        <% end -%>
        <% unless Seek::Util.multi_files_asset_types.include?(asset.class) %>
            <%= render :partial => "assets/view_content", :locals => {:content_blob => display_asset.content_blob, :button_style => true} -%>
        <% end %>
    <% elsif logged_in? -%>
        <li>
          <%= render :partial=>"assets/request_resource",:locals=>{:resource=>asset} %>
        </li>
    <% end -%>
<% end -%>

  <% if asset.can_manage? -%>
    <% if asset.is_downloadable? -%>
        <li><%= link_to_function image("new")+" Upload new version", visual_effect(:toggle_appear, "upload_new_version_form") -%></li>
    <% end -%>
    <li><%= image_tag_for_key('manage', polymorphic_path(asset,:action=>:edit), nil, nil, "Manage #{human_name}") -%></li>
    <% if asset.is_publishable? -%>
        <% if !asset.is_published? && asset.publish_authorized? %>
            <% if asset.can_publish?
                 confirm_message = "After publishing, all visitors, even without a login, can access this #{human_name}.\nAre you sure you want to publish this #{human_name}?"
               else
                 confirm_message = "An email will be sent to the Gatekeepers of the projects associated with this #{human_name} to ask for publishing approval. This #{human_name} will not be published until one of the Gatekeepers has granted approval.\nAre you sure you want to process?"
               end
            %>
            <li><%= image_tag_for_key('publish', polymorphic_path(asset,:action=>:single_publish), nil, { :confirm => confirm_message, :title => "After publishing, all visitors, even without a login, can access this #{human_name}", :method => :post }, "Publish #{human_name}") -%></li>
        <% end %>
        <li><%= image_tag_for_key('publish', polymorphic_path(asset,:action=>:isa_publishing_preview), nil, nil, "Publish whole ISA") -%></li>
    <% end -%>
  <% elsif asset.can_edit? -%>
    <%# this is not owner, but current user can edit -%>
    <li><%= image_tag_for_key('edit', polymorphic_path(asset,:action=>:edit), nil, nil, "Edit #{human_name}") -%></li>
  <% end -%>

  <% if asset.can_delete? -%>
    <li><%= image_tag_for_key('destroy', polymorphic_path(asset), nil, { :confirm => delete_confirm_message, :method => :delete }, "Delete #{human_name}") -%></li>
  <% end -%>

  <% if (asset.can_delete? or current_user.try(:admin?)) and asset.respond_to? :to_presentation %>
      <li>
        <%= image_tag_for_key "arrow_right", convert_to_presentation_data_file_path(asset.id), nil, {:title => "click to move this data file to presentations",:confirm => "Are you sure you wish to move this data file to presentations? Doing so is irreversible!", :method => :post}, 'Move to presentations'%>
     </li>
   <% end %>

<%= render :partial => "subscriptions/subscribe", :locals => {:object => asset } -%>




