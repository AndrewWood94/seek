<%= dropdown_button('Add to collection', 'add', menu_options: { 'data-role' => 'add-to-collection-list' }) do %>
  <% collections.each do |collection| %>
    <li><%= link_to collection.title, '#', 'data-role' => 'add-to-collection-link', 'data-url' => collection_items_path(collection.id) -%></li>
  <% end %>
<% end %>

<%= modal(id: 'add-collection-item-modal', size: 'm', class: 'text-left') do %>
  <%= modal_header('Add to collection') %>
  <%= modal_body do %>
    <div class="form-group">
      <label>Comment</label>
      <%= text_field_tag('item[comment]', nil, placeholder: 'Comment (optional)', id: 'collection-item-comment', class: 'form-control', autocomplete: 'off') -%>
    </div>
    <%= hidden_field_tag('collection-item-url', '', id: 'collection-item-url') %>
  <% end %>
  <%= modal_footer do %>
    <%= link_to('Add', '#', id: 'add-collection-item-submit', class: 'btn btn-primary pull-right', 'data-dismiss' => 'modal') %>
  <% end %>
<% end %>

<script>
    $j(document).ready(function () {
        $j('[data-role="add-to-collection-list"]').on('click', '[data-role="add-to-collection-link"]', function () {
            $j('#add-collection-item-modal').modal('show');
            $j('#collection-item-url').val($j(this).data('url'));

            return false;
        });

        $j('#add-collection-item-submit').click(function () {
            var btn = $j(this);
            btn.spinner('add');
            $j.ajax({
                url: $j('#collection-item-url').val(),
                type: 'POST',
                data: {
                    item: {
                        asset_id: '<%= resource.id %>',
                        asset_type: '<%= resource.class.name %>',
                        comment: $j('#collection-item-comment').val()
                    }
                },
                success: function (resp) {
                    alert("Success!");
                },
                error: function () {
                    alert("Error!");
                },
                complete: function () {
                    btn.spinner('remove');
                }
            });
        });
    });
</script>
