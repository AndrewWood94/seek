<%= javascript_include_tag :multi_step_wizard %>

Content blob id: <%= @data_file.content_blob.id %>

<%= form_for(@data_file, url: {action: :create_metadata}) do |f| -%>
  <%= hidden_field_tag 'content_blob_id', @data_file.content_blob.id %>
  <div id='datafile-multi-set' class='multi-step'>
    <div class="asset_form">
      <%= error_messages_for :data_file -%>


      <div id='step-1' class='multi-step-block'>
        <div class="panel panel-default">

          <div class="form-group">
            <label>Title <span class="required">*</span></label>
            <%= f.text_field :title, :class => "form-control" -%>
          </div>

          <div class="form-group">
            <label>Description</label>
            <%= f.text_area :description, :class => "form-control", :rows => 5 -%>
          </div>

          <div class="form-group">
            <div class='help-block'>Check this box if this data is the result of a model simulation</div>
            <label>
              <%= f.check_box :simulation_data %>
              Model simulation data
            </label>
          </div>


          <%= render :partial => "projects/project_selector", locals: {resource: @data_file, allow_nil: Seek::Config.is_virtualliver} -%>


          <%= render :seek_partial => "assets/select_tags", locals: {collapsed: false} if DataFile.is_taggable? %>


          <%= cancel_button(data_files_path) -%>

          <div class="multi-step-buttons">
            <%= multi_step_forward_buttons %>
          </div>

        </div>
      </div>


      <div id='step-2' class='multi-step-block multi-step-datafile-block'>
        <div class="panel panel-default">

          <%= render :partial => "scales/scales_selector", locals: {object: @data_file} if show_scales? %>

          <%= render :partial => 'assets/license_selector', locals: {resource: @data_file} %>

          <%= render :partial => "sharing/form" -%>

          <%= render :partial => "assets/author_form", locals: {resource_type: "DataFile",
                                                                existing_creators: [],
                                                                other_creators: [],
                                                                collapsed: false} %>

          <%= cancel_button(data_files_path) -%>

          <div class="multi-step-buttons">
            <%= multi_step_back_buttons %>
            <%= multi_step_forward_buttons %>
          </div>
        </div>
      </div>


      <div id='step-3' class='multi-step-block multi-step-datafile-block'>
        <% if Seek::Config.assays_enabled %>
          <div class="panel panel-default">

            <ul class="nav nav-tabs" role="tablist">
              <li class="active">
                <a href="#existing-assay" aria-controls="existing-assay" role="tab" data-toggle="tab">Existing assay</a>
              </li>
              <li>
                <a href="#new-assay" aria-controls="new-assay" role="tab" data-toggle="tab">New assay</a>
              </li>
            </ul>

            <div class="tab-content">

              <div role="tabpanel" class="tab-pane active" id="existing-assay">
                <%= render :partial => "assays/associate_assays", locals: {resource: @data_file, collapsed: false} %>
              </div>

              <div role="tabpanel" class="tab-pane" id="new-assay">

                <%= hidden_field_tag 'assay[assay_class_id]', @assay.assay_class_id %>

                <div class="form-group">
                  <label>
                    <%= check_box_tag 'assay[create_assay]' %>
                    Create a new Assay ?
                  </label>
                </div>

                <div class="form-group">
                  <label>Title <span class="required">*</span></label>
                  <%= text_field_tag 'assay[title]', @assay.title, :class => "form-control" %>
                </div>

                <div class="form-group">
                  <label>Description</label>
                  <%= text_area_tag 'assay[description]', @assay.description, :class => "form-control", :rows => 5 %>
                </div>

                <div class="form-group">
                  <label>Study</label>
                  <%= assay_study_selection('assay[study_id]', @assay.study) %>
                </div>

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label>Experimental assay type</label>
                      <%= assay_type_select_tag "assay[assay_type_uri]", @assay.is_modelling?, @assay, {:class => "form-control"} %>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group">
                      <label>Technology type</label>
                      <%= technology_type_select_tag "assay[technology_type_uri]", @assay, {:class => "form-control"} %>
                    </div>
                  </div>
                </div>

              </div>
            </div>


            <%= cancel_button(data_files_path) -%>

            <div class="multi-step-buttons">
              <%= multi_step_back_buttons %>
              <%= multi_step_forward_buttons %>
            </div>
          </div>
        <% end %>
      </div>


      <div id='step-4' class='multi-step-block multi-step-datafile-block'>
        <div class="panel panel-default">
          <%= render :partial => "assets/attribution_form", :locals => {:resource_class => DataFile,
                                                                        :existing_attributions => [], collapsed: false} -%>

          <%= render :partial => "assets/associate_publication", :locals => {:resource_type => "DataFile",
                                                                             :related_publications => [], collapsed: false} -%>

          <% if Seek::Config.events_enabled %>
            <%= render :partial => "assets/associate_event", :locals => {:resource => @data_file, collapsed: false} -%>
          <% end -%>

          <div class="multi-step-buttons">
            <%= multi_step_back_buttons %>
          </div>

          <%= submit_tag "Create",
                         :id => "data_file_submit_btn",
                         :onclick => "javascript: validateResourceFields(true,'data_file',true); return(false);",
                         :class => 'btn btn-primary' -%>
          <%= cancel_button(data_files_path) -%>
          <%= preview_permission_popup_link(@data_file) -%>
        </div>
      </div>

    </div>
  </div>
<% end -%>


