<%= form_for([@project,@openbis_space],html:{id:'openbis-space-form'}) do |f| %>

    <%= f.error_messages %>

    <div class="form-group">
      <label>AS Endpoint</label><span class="required">*</span>
      <%= f.text_field :as_endpoint, :class=>"form-control login-credential"-%>
    </div>

    <div class="form-group">
      <label>DSS Endpoint</label><span class="required">*</span>
      <%= f.text_field :dss_endpoint, :class=>"form-control login-credential"-%>
    </div>

    <div class="form-group">
      <%= f.label :username -%><span class="required">*</span>
      <%= f.text_field :username, :class=>"form-control login-credential"-%>
    </div>

    <div class="form-group">
      <%= f.label :password -%><span class="required">*</span>
      <%= f.password_field :password, :class=>"form-control login-credential"-%>
    </div>

    <div class="form-group">
      <%= f.label :space -%><span class="required">*</span>
      <%= f.text_field :space_name, :class=>"form-control login-credential"-%>
    </div>

    <span id="check-result"></span>

    <%= content_tag(:button,type:'button',class:'btn btn-primary',id:'submit-button'){@openbis_space.new_record? ? "Add" : "Update"} %>
    or
    <%= cancel_button(project_openbis_spaces_path(@project)) %>


<% end %>

<script>

  function testEndpoint() {
    $j.ajax('<%= test_endpoint_project_openbis_spaces_path(@project) %>', {
          data: $j('input.login-credential').serialize(),
          success: function (data) {
            if (data.result==true) {
              $j('#check-result').html('Authentication succeeded')
              $j('form#openbis-space-form').submit();
            }
            else {
              $j('#check-result').html('Authentication failed!')
              $j('#submit-button').prop('disabled', false);
            }
          },
          beforeSend: function () {
            $j('#check-result').html('<%= image('spinner') %> Checking authentication');
          }
        }
    );
  }

  $j('#submit-button').on('click', function() {
    $j('#submit-button').prop('disabled', true);
    testEndpoint();
  });

</script>