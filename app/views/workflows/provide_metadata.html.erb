<h1>New <%= t('workflow') %></h1>

<%= form_tag({:action => :create_metadata}, :multipart => true) do -%>
  <%= hidden_field_tag 'content_blob_id', session[:uploaded_content_blob_id] %>
  <%= hidden_field_tag 'workflow[workflow_class_id]', @workflow.workflow_class_id %>

  <div class="asset_form">
    <% if @errors && @errors.any? %>
      <div class="alert alert-danger">
        <strong>Extraction errors:</strong>
        <ul>
          <% @errors.each do |error| %>
            <li><%= error %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <% if @warnings && @warnings.any? %>

      <div class="alert alert-warning">
        <strong>Extraction warnings:</strong>
        <ul>
          <% @warnings.each do |warning| %>
            <li><%= warning %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= error_messages_for :workflow -%>

    <div class="form-group">
      <label class="required">Title</label>
      <%= text_field_tag 'workflow[title]', @workflow.title, :class=>"form-control", :readonly => session[:metadata].has_key?(:title) -%>
    </div>

    <div class="form-group">
      <label>Description</label>
      <%= text_area_tag 'workflow[description]', @workflow.description, :class=>"form-control", :readonly => session[:metadata].has_key?(:description) -%>
    </div>

    <%= render :partial => "projects/project_selector", :locals => { :resource => @workflow, :allow_nil => Seek::Config.is_virtualliver } -%>
    <%= render :partial => 'assets/license_selector', :locals => { :resource => @workflow } %>
    <%= render :partial => 'sharing/form' -%>

    <%= hidden_field_tag 'workflow[internals]', raw(@workflow.internals.to_json) -%>

    <div>
      <%= preview_permission_popup_link(@workflow)-%>
      <%= create_button :id => "workflow_submit_btn",
                        :onclick => "return validateResourceFields('workflow')",
                        :class => 'btn btn-primary' -%>
      or <%= cancel_button(workflows_path) -%>
    </div>
  </div>
<% end -%>
