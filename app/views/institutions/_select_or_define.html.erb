<style>
  .label {
    font-size:100%;
    background-color: royalblue;
  }
</style>

<%= hidden_field_tag 'institution[id]', @institution.id %>
<%= hidden_field_tag 'institution[title]', @institution.title %>

<div class="form-group" id="combined_typeahead">
  <div class="help-block">
    This is the <%= t('institution').downcase %> <strong>you</strong> are associated with, and will be used when defining your membership with the <%= t('project') %>.
  </div>
  <div class="help-block">
    Type the name of the <%= t('institution').downcase %>, or part of the name or the city it may be associated with. From the list of the results
    found, select the <%= t('institution').downcase %> you are looking for.
    <br>
  </div>
  <div class="help-block">
    Suggested <%= t('institution').pluralize.downcase %> are sourced from the local instance first, followed by the <%= link_to(image('ror_id', title: 'ROR',width: '30'), 'https://ror.org/', target: '_blank') %> service remotely.
    Whenever possible, select the <%= t('institution').downcase %> from the local list.
    If the desired <%= t('institution').downcase %> is not listed, continue typing its full name and select one from ROR.
  </div>

  <label class="control-label">Type the name of the <%= t('institution'.downcase) %> </label><span class="required">*</span>
  <%= text_field_tag :search, nil, placeholder: "Search...", class: "form-control typeahead" %>
  <small id="new_institution_reminder" style="display: none; color:darkseagreen; ">
    This institution is not in <%= Seek::Config.instance_name %>. You will create this new institution along with your project.
  </small>
</div>

<div class="form-group">
  <label class="control-label">ROR ID</label>    <%= link_to(image('ror_id', title: 'ROR'), 'https://ror.org/', target: '_blank') %>
  <%= help_icon('The ROR ID (Research Organization Registry Identifier) is a unique 9-character alphanumeric code (e.g., 01f7bcy98).
   To find out more and get your ORCID ID please visit https://ror.org/') -%>
  <%= text_field_tag 'institution[ror_id]', @institution.ror_id, class: "form-control institution-user-input" %>
</div>

<div class="form-group">
  <label class="control-label">Website</label>
  <%= text_field_tag('institution[web_page]', @institution.web_page, class:'form-control institution-user-input') %>
</div>

<div class="form-group">
  <label class="control-label">City</label>
  <%= text_field_tag('institution[city]', @institution.city, class:'form-control institution-user-input') %>
</div>

<div class="form-group">
  <label class="control-label">Country</label>
  <%= text_field_tag 'institution[country]', @institution.nil? ? '' : CountryCodes.country(@institution.country), class: "form-control institution-user-input" %>
</div>

<script type='application/javascript'>

    function toggleUserInput(disabled) {
        $j(".institution-user-input").prop('disabled',disabled);
    }
    $j(document).ready(function () {
        toggleUserInput(<%= (@institution.id.blank? || @institution.id == 0) ? 'false' : 'true' -%>);

        $j('select#institution_country').on('change',function() {
            checkSubmitButtonEnabled();
        });

        $j('select#institution_id').on('select2:select', function(event) {
            var data = event.params.data;
            if (data.id==data.text) { //new record
                toggleUserInput(false);
            }
            else {
                toggleUserInput(true);
            }
            $j('#institution_title').val(data.text);
            $j('#institution_web_page').val(data.web_page);
            $j('#institution_city').val(data.city);
            $j('#institution_country').val(data.country);
            checkSubmitButtonEnabled();
        });

        $j('select#institution_id').on('select2:unselect', function(event) {
            toggleUserInput(true);
            $j('#institution_title').val('');
            $j('#institution_web_page').val('');
            $j('#institution_country').val('');
            checkSubmitButtonEnabled();
        });

    });
</script>

